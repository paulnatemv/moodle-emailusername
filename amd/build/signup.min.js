define([],function(){"use strict";var minLength=8,init=function(config){minLength=config.minlength||8,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){setupForm(config)}):setupForm(config)},setupForm=function(config){var usernameField=document.getElementById("id_username"),emailField=document.getElementById("id_email"),passwordField=document.getElementById("id_password");usernameField&&emailField&&setupUsernameField(usernameField,emailField,config),passwordField&&setupPasswordRequirements(passwordField),reorderFields()},setupUsernameField=function(usernameField,emailField,config){var usernameGroup=usernameField.closest('.form-group, .fitem, [data-groupname="username"]');if(config.hideusername){usernameGroup&&(usernameGroup.style.display="none"),usernameField.style.display="none";var label=document.querySelector('label[for="id_username"]');if(label){var labelGroup=label.closest(".form-group, .fitem");labelGroup&&(labelGroup.style.display="none")}}else usernameField.readOnly=!0,usernameField.style.backgroundColor="#e9ecef",usernameField.style.cursor="not-allowed",usernameField.style.color="#6c757d",usernameField.setAttribute("tabindex","-1"),usernameField.placeholder="← Auto-filled from email";emailField.addEventListener("input",function(){var email=emailField.value.trim().toLowerCase();usernameField.value=email}),emailField.addEventListener("paste",function(){setTimeout(function(){var email=emailField.value.trim().toLowerCase();usernameField.value=email},10)});var form=emailField.closest("form");form&&form.addEventListener("submit",function(){var email=emailField.value.trim().toLowerCase();usernameField.value=email}),emailField.value&&(usernameField.value=emailField.value.trim().toLowerCase())},setupPasswordRequirements=function(passwordField){var requirements={"req-length":function(pwd){return pwd.length>=minLength},"req-lowercase":function(pwd){return/[a-z]/.test(pwd)},"req-uppercase":function(pwd){return/[A-Z]/.test(pwd)},"req-number":function(pwd){return/[0-9]/.test(pwd)},"req-special":function(pwd){return/[^a-zA-Z0-9]/.test(pwd)}},checkRequirements=function(){var password=passwordField.value;for(var reqId in requirements)if(requirements.hasOwnProperty(reqId)){var reqElement=document.getElementById(reqId);if(reqElement){var met=requirements[reqId](password),icon=reqElement.querySelector(".req-icon");met?(reqElement.classList.add("met"),icon&&(icon.textContent="✓")):(reqElement.classList.remove("met"),icon&&(icon.textContent="○"))}}};passwordField.addEventListener("input",checkRequirements),passwordField.addEventListener("paste",function(){setTimeout(checkRequirements,10)}),passwordField.value&&checkRequirements()},reorderFields=function(){var form=document.querySelector("form.mform");if(form){var usernameGroup=document.getElementById("id_username"),emailGroup=document.getElementById("id_email"),email2Group=document.getElementById("id_email2");usernameGroup&&emailGroup&&(usernameGroup=usernameGroup.closest(".form-group, .fitem, [data-groupname]"),emailGroup=emailGroup.closest(".form-group, .fitem, [data-groupname]"),email2Group&&(email2Group=email2Group.closest(".form-group, .fitem, [data-groupname]")),usernameGroup&&emailGroup&&usernameGroup.parentNode===emailGroup.parentNode&&(usernameGroup.parentNode.insertBefore(emailGroup,usernameGroup),email2Group&&emailGroup.parentNode.insertBefore(email2Group,usernameGroup)))}};return{init:init}});
